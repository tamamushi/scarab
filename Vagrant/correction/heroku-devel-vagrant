# -*- mode: python -*-
# This vagrant file made for enveroiment of python developement.
# vi: set ts=4 : 

VAGRANTFILE_API_VERSION = "2"

Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
	config.vm.box		= "centos65" 
	config.vm.box_url	= "~/vagrantdir/box/centos65-x86_64-20140116.box"
	config.vm.network "private_network", ip: "192.168.33.11"

	config.vm.synced_folder "./data", "/vagrant_data"
	config.vm.provider "virtualbox" do |vb|
		vb.memory = "1024"
	end

	config.vm.provision :shell, :inline =><<EOT
		## python2.7 install
		echo "[Starting installation Development tools]";
		yum groupinstall -y "Development tools"
		yum install -y wget

		## Need for make enveroiment of python 2.7.10 development.
		echo "[Starting installation various library for python]";
		yum install -y zlib-devel bzip2 bzip2-devel readline-devel sqlite sqlite-devel openssl-devel

		yum localinstall -y http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
		yum localinstall -y http://dl.iuscommunity.org/pub/ius/stable/CentOS/6/x86_64/ius-release-1.0-11.ius.centos6.noarch.rpm

		echo "[Starting installation Python 2.7]"
		yum install -y python27
		yum install -y python27-devel
		yum install -y python27-setuptools
 		yum install -y python27-mod_wsgi

		## Easy_install install
		curl -skL https://bitbucket.org/pypa/setuptools/raw/bootstrap/ez_setup.py | /usr/bin/python2.7
		## pip install
		curl -skL https://raw.githubusercontent.com/pypa/pip/master/contrib/get-pip.py | /usr/bin/python2.7

		pip install virtualenv
		pip install virtualenvwrapper

		## pyenv install
		git clone git://github.com/yyuu/pyenv.git /home/vagrant/.pyenv
		git clone https://github.com/yyuu/pyenv-pip-rehash.git /home/vagrant/.pyenv/plugins
		git clone git://github.com/yyuu/pyenv-virtualenv.git /home/vagrant/.pyenv/plugins
		curl -skL https://raw.githubusercontent.com/tamamushi/scarab/master/Script/template/env.pyenv | cat >> /home/vagrant/.bash_profile
		chown -R vagrant /home/vagrant/.pyenv
		chgrp -R vagrant /home/vagrant/.pyenv
		chmod -R g+rwxXs /home/vagrant/.pyenv

		## Need for make enveroiment of ruby delvelopement.
		yum -y install libcurl-devel
		cd /usr/local/; git clone git://github.com/sstephenson/rbenv.git rbenv
		mkdir rbenv/shims rbenv/versions rbenv/plugins
		groupadd rbenv
		chgrp -R rbenv rbenv
		chmod -R g+rwxXs rbenv

		git clone git://github.com/sstephenson/ruby-build.git /usr/local/rbenv/plugins/ruby-build
		chgrp -R rbenv /usr/local/rbenv/plugins/ruby-build
		chmod -R g+rwxs /usr/local/rbenv/plugins/ruby-build

		git clone git://github.com/sstephenson/rbenv-default-gems.git /usr/local/rbenv/plugins/rbenv-default-gems
		chgrp -R rbenv /usr/local/rbenv/plugins/rbenv-default-gems
		chmod -R g+rwxs /usr/local/rbenv/plugins/rbenv-default-gems

		curl -skL https://raw.githubusercontent.com/tamamushi/scarab/master/Script/template/env.rbenv | cat > /etc/profile.d/rbenv.sh
		echo -e "bundler \nrdenv-rehash" >> /usr/local/rbenv/default-gems

		## Heroku toolblet install
		wget -qO- https://toolbelt.heroku.com/install.sh | sh

		## MySQL Install
		echo "[Starting installation MySQL community server]"
		yum -y install http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm
		yum -y install mysql-community-server
		chkconfig mysqld on

		nohup /bin/sh /usr/bin/mysqld_safe --datadir=/var/lib/mysql --socket=/var/lib/mysql/mysql.sock \
			--pid-file=/var/run/mysqld/mysqld.pid --basedir=/usr --user=mysql --skip-grant-tables --skip-networking &

		password=`cat /dev/urandom | LC_CTYPE=C tr -dc ‘[:alnum:]’ | head -c 16 ; echo`

		/usr/bin/mysqladmin drop test -f
		/usr/bin/mysql -e "delete from user where user = '';" -D mysql
		/usr/bin/mysql -e "DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');" -D mysql
		/usr/bin/mysql -e "SET PASSWORD FOR 'root'@'::1' = PASSWORD('${password}');" -D mysql
		/usr/bin/mysql -e "SET PASSWORD FOR 'root'@'127.0.0.1' = PASSWORD('${password}');" -D mysql
		/usr/bin/mysql -e "SET PASSWORD FOR 'root'@'localhost' = PASSWORD('${password}');" -D mysql
		/usr/bin/mysql -e "grant all privileges on *.* to root@0.0.0.0 identified by '${password} with grant option';" -D mysql
		/usr/bin/mysqladmin flush-privileges -pnewpassword

		echo ${password} > /etc/my.cnf.d/password

		## Bower Install
		### nodebrew Install
		curl -L git.io/nodebrew | perl - setup
		echo 'export PATH=$HOME/.nodebrew/current/bin:$PATH' >> /nome/vagrant/.bash_profile
EOT
	end
